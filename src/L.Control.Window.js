L.Control.Window=L.Control.extend({includes:L.Evented.prototype||L.Mixin.Events,options:{element:"map",className:"control-window",visible:false,title:undefined,closeButton:true,content:undefined,prompt:undefined,maxWidth:600,modal:false,position:"center"},initialize:function(b,d){var c=this;if(b.hasOwnProperty("options")){b=b.getContainer()}d.element=b;L.setOptions(this,d);var a="nonmodal";if(this.options.modal){a="modal"}this._wrapper=L.DomUtil.create("div",a+" leaflet-control-window-wrapper",L.DomUtil.get(this.options.element));this._container=L.DomUtil.create("div","leaflet-control leaflet-control-window "+this.options.className,this._wrapper);this._container.setAttribute("style","max-width:"+this.options.maxWidth+"px");this._containerTitleBar=L.DomUtil.create("div","titlebar",this._container);this.titleContent=L.DomUtil.create("h2","title",this._containerTitleBar);this._containerContent=L.DomUtil.create("div","content",this._container);this._containerPromptButtons=L.DomUtil.create("div","promptButtons",this._container);if(this.options.closeButton){this._closeButton=L.DomUtil.create("a","close",this._containerTitleBar);this._closeButton.innerHTML="&times;"}var e=L.DomEvent.stopPropagation;L.DomEvent.on(this._wrapper,"contextmenu",e).on(this._wrapper,"click",e).on(this._wrapper,"mousedown",e).on(this._wrapper,"touchstart",e).on(this._wrapper,"dblclick",e).on(this._wrapper,"mousewheel",e).on(this._wrapper,"MozMousePixelScroll",e);if(this.options.closeButton){var f=this._closeButton;L.DomEvent.on(f,"click",this.hide,this)}if(this.options.title){this.title(this.options.title)}if(this.options.content){this.content(this.options.content)}if(typeof(this.options.prompt)=="object"){this.prompt(this.options.prompt)}if(this.options.visible){this.show()}},disableBtn:function(){this._btnOK.disabled=true;this._btnOK.className="disabled"},enableBtn:function(){this._btnOK.disabled=false;this._btnOK.className=""},title:function(b){if(b==undefined){return this.options.title}this.options.title=b;var a=b||"";this.titleContent.innerHTML=a;return this},remove:function(){L.DomUtil.get(this.options.element).removeChild(this._wrapper);var a=L.DomEvent.stopPropagation;L.DomEvent.off(this._wrapper,"contextmenu",a).off(this._wrapper,"click",a).off(this._wrapper,"mousedown",a).off(this._wrapper,"touchstart",a).off(this._wrapper,"dblclick",a).off(this._wrapper,"mousewheel",a).off(this._wrapper,"MozMousePixelScroll",a);if(this._closeButton&&this._close){var b=this._closeButton;L.DomEvent.off(b,"click",this.close,this)}return this},mapResized:function(){},show:function(g){if(g){this.options.position=g}L.DomUtil.addClass(this._wrapper,"visible");this.setContentMaxHeight();var h=this._container.offsetWidth;var c=this._container.offsetHeight;var e=8;var b=L.DomUtil.get(this.options.element);var j=b.getBoundingClientRect();var a=j.right-j.left||Math.max(document.documentElement.clientWidth,window.innerWidth||0);var k=j.bottom-j.top||Math.max(document.documentElement.clientHeight,window.innerHeight||0);var i=j.top;var d=j.left;var f=0;if(this.options.position=="topLeft"){this.showOn([d,i+f])}else{if(this.options.position=="left"){this.showOn([d,i+k/2-c/2-e+f])}else{if(this.options.position=="bottomLeft"){this.showOn([d,i+k-c-e*2-f])}else{if(this.options.position=="top"){this.showOn([d+a/2-h/2-e,i+f])}else{if(this.options.position=="topRight"){this.showOn([d+a-h-e*2,i+f])}else{if(this.options.position=="right"){this.showOn([d+a-h-e*2,i+k/2-c/2-e+f])}else{if(this.options.position=="bottomRight"){this.showOn([d+a-h-e*2,i+k-c-e*2-f])}else{if(this.options.position=="bottom"){this.showOn([d+a/2-h/2-e,i+k-c-e*2-f])}else{this.showOn([d+a/2-h/2-e,i+i+k/2-c/2-e+f])}}}}}}}}return this},showOn:function(b){this.setContentMaxHeight();L.DomUtil.setPosition(this._container,L.point(Math.round(b[0]),Math.round(b[1]),true));var a=new L.Draggable(this._container,this._containerTitleBar);a.enable();L.DomUtil.addClass(this._wrapper,"visible");this.fire("show");return this},hide:function(a){L.DomUtil.removeClass(this._wrapper,"visible");this.fire("hide");return this},getContainer:function(){return this._containerContent},content:function(a){if(a==undefined){return this.options.content}this.options.content=a;this.getContainer().innerHTML=a;return this},prompt:function(a){if(a==undefined){return this.options.prompt}this.options.prompt=a;this.setPromptCallback(a.callback);this.setActionCallback(a.action);var d=this.options.prompt.buttonCancel||undefined;var c=this.options.prompt.buttonOK||"OK";var f=this.options.prompt.buttonAction||undefined;if(f!=undefined){var g=L.DomUtil.create("button","",this._containerPromptButtons);L.DomEvent.on(g,"click",this.action,this);g.innerHTML=f}var b=L.DomUtil.create("button","",this._containerPromptButtons);L.DomEvent.on(b,"click",this.promptCallback,this);b.innerHTML=c;this._btnOK=b;if(d!=undefined){var e=L.DomUtil.create("button","",this._containerPromptButtons);L.DomEvent.on(e,"click",this.close,this);e.innerHTML=d}return this},container:function(a){if(a==undefined){return this._container.innerHTML}this._container.innerHTML=a;if(this.options.closeButton){this._closeButton=L.DomUtil.create("a","close",this._container);this._closeButton.innerHTML="&times;";L.DomEvent.on(this._closeButton,"click",this.close,this)}return this},setPromptCallback:function(c){var b=this;if(typeof(c)!="function"){c=function(){console.warn("No callback function specified!")}}var a=function(){b.close();c()};this.promptCallback=a;return this},setActionCallback:function(c){var b=this;if(typeof(c)!="function"){c=function(){console.warn("No callback function specified!")}}var a=function(){b.hide();c()};this.action=a;return this},setContentMaxHeight:function(){var e=68;if(this.options.title){e+=this._containerTitleBar.offsetHeight-36}if(typeof(this.options.prompt)=="object"){e+=this._containerPromptButtons.offsetHeight-20}var b=L.DomUtil.get(this.options.element);var d=b.getBoundingClientRect();var a=d.bottom-d.top;var c=a-e;this._containerContent.setAttribute("style","max-height:"+c+"px")},close:function(){this.hide();this.remove();this.fire("close");return undefined}});L.control.window=function(a,b){return new L.Control.Window(a,b)};